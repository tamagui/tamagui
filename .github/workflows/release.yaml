name: Release

# testing on a branch for now

on:
  push:
    branches:
      - test-release
    tags:
      - "release-*"

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT }}
          fetch-depth: 0

      - name: Install
        uses: ./.github/actions/install

      - name: Install playwright
        run: npx playwright install
        
      - name: Test
        run: yarn test

      - name: Publish
        # just testing for now so --skip-publish
        run: yarn release:beta:dirty --ci --tamagui-git-user --skip-publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

  tagged-release:
    name: Tagged Release
    runs-on: ubuntu-18.04
    # needs: release

    steps:
      - uses: marvinpinto/action-automatic-releases@latest
        with:
          repo_token: "${{ github.token }}"
          prerelease: false
